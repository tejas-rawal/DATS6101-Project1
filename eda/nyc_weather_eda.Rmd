---
title: "NYC Weather Data Preliminary EDA"
author: "Tejas Rawal"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
---

```{r init, include=F}
# The package "ezids" (EZ Intro to Data Science) includes a lot of the helper functions we developed for the course. 
# Some of the frequently used functions are loadPkg(), xkabledply(), xkablesummary(), uzscale(), etc.
library(ezids)
# tidyverse includes ggplot2
library(tidyverse)
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = F, results = "markup", message = F)
options(scientific=T, digits = 3) 
```

# NYC Weather Data: Temperature analysis

```{r load data}
nyc_weather <- tibble(read.csv("NYC_weather_1869_2022.csv")) %>%
  dplyr::select(TMAX, TMIN, DATE, PRCP, SNOW)
# view structure
str(nyc_weather)
# get summary
xkablesummary(nyc_weather)
```

Convert DATE column from `char` to `Date` type
```{r}
nyc_weather <- nyc_weather %>%
  mutate(DATE = as.Date(DATE, format="%Y-%m-%d"))

# review dataset structure
xkablesummary(nyc_weather)
```

Add a MONTH column to the dataset. The month is extracted from the DATE.
```{r}
nyc_weather <- nyc_weather %>%
  mutate(MONTH = month(DATE, label=T))

str(nyc_weather)
# review dataset structure
xkablesummary(nyc_weather)
```

### Temperature Plots
```{r}
ggplot(nyc_weather) +
  geom_histogram(aes(x=TMAX, fill="TMAX"), na.rm=TRUE, alpha=0.5, color="black", bins=100, binwidth=2) +
  geom_histogram(aes(x=TMIN, fill="TMIN"), na.rm=TRUE, alpha=0.5, color="black", bins=100, binwidth=2) +
  labs(title="Distribution of TMAX and TMIN", x="Temperature (°F)", y="Count") +
  scale_fill_manual(name="Column", values=c(TMAX="red",TMIN="blue"))

nyc_weather %>%
  ggplot(aes(x=MONTH, y=TMAX, fill=MONTH)) +
  geom_boxplot(na.rm=TRUE, alpha=0.7, color="black") +
  labs(title="TMAX by Month", x="Month", y="Temperature (°F)")

nyc_weather %>%
  ggplot(aes(x=MONTH, y=TMIN, fill=MONTH)) +
  geom_boxplot(na.rm=TRUE, alpha=0.7, color="black") +
  labs(title="TMIN by Month", x="Month", y="Temperature (°F)")

qqnorm(nyc_weather$TMAX,
       main="QQ Plot TMAX",
       xlab="Theoretical Quantile",
       ylab="Temperature  (°F)",
       col="red")
qqline(nyc_weather$TMAX, lwd=1, lty=2)

qqnorm(nyc_weather$TMIN,
       main="QQ Plot TMIN",
       xlab="Theoretical Quantile",
       ylab="Temperature  (°F)",
       col="blue")
qqline(nyc_weather$TMIN, lwd=1, lty=2)
```

### Average daily temperature max and min by month, all time
```{r temperature analysis}
# group data by month
# and calculate average
nyc_weather_by_month <- nyc_weather %>%
  group_by(MONTH) %>%
  summarize(avg_temp_max = mean(TMAX, na.rm=T),
            avg_temp_min = mean(TMIN, na.rm=T),
            avg_prcp = mean(PRCP, na.rm=T),
            avg_snow = mean(SNOW, na.rm=T))

# Create line plot
nyc_weather_by_month %>%
  ggplot(aes(x=MONTH, group=1)) +
  geom_line(aes(y=avg_temp_max, color="Avg.TMAX"), na.rm=TRUE) +
  geom_line(aes(y=avg_temp_min, color="Avg.TMIN"), na.rm=TRUE, linetype=2) +
  labs(x="Month", y="Average Temperature (°F)") +
  scale_color_manual(name="Column", values=c(Avg.TMAX="red",Avg.TMIN="steelblue"))

# side-by-side bar plot
nyc_weather_by_month %>%
  dplyr::select(MONTH, avg_temp_max, avg_temp_min) %>%
  gather(key = "data_point", value="value", avg_temp_max, avg_temp_min) %>%
  ggplot(aes(x=MONTH, y=value, fill=data_point)) +
    geom_col(na.rm=TRUE, alpha=0.7, color="black", position="dodge") +
    labs(x="Month", y="Average Temperature (°F)")
```


### Average percipitation and snow fall by month, all time
```{r}
nyc_weather_by_month %>%
  dplyr::select(MONTH, avg_prcp, avg_snow) %>%
  gather(key = "data_point", value="value", avg_prcp, avg_snow) %>%
  ggplot(aes(x=MONTH, y=value, fill=data_point)) +
    geom_col(na.rm=TRUE, alpha=0.7, color="black", position="dodge") +
    labs(x="Month", y="Amount (inches)")
```

## Categorical Analysis

For this analysis, I sought to subset the data into 30-50 year periods as such:  
* 1900-1940: Industrial Revolution  
* 1940-1980: Cold War Era  
* 1980-present: Modern Era

### 1900-1940
#### Temperature and Precipitation Boxplots
```{r}
# filter weather data for years 1890-1930
industrial_era <- nyc_weather %>%
  dplyr::select(-MONTH) %>%
  filter(year(DATE) >= 1900, year(DATE) < 1940)

str(industrial_era)

industrial_era %>%
  ggplot() +
  geom_histogram(aes(x=TMAX, fill="TMAX"), na.rm=TRUE, alpha=0.8, fill="steelblue", bins=100, binwidth=2) +
  labs(title="Distribution of TMAX for Years 1900-1940", x="Temperature (°F)", y="Count")

industrial_era %>%
  dplyr::select(TMAX, TMIN, DATE) %>%
  gather(key="data_point", value="value", TMAX, TMIN) %>%
  ggplot(aes(y=value, fill=data_point)) +
  geom_boxplot(na.rm=TRUE, alpha=0.7, color="black") +
  labs(title="Distribution of TMAX and TMIN for Years 1900-1940", x="Data Point", y="Temperature (°F)")

industrial_era %>%
  dplyr::select(PRCP, SNOW, DATE) %>%
  gather(key="data_point", value="value", PRCP, SNOW) %>%
  ggplot(aes(y=value, fill=data_point)) +
  geom_boxplot(na.rm=TRUE, alpha=0.7, color="black") +
  labs(title="Distribution of PRCP and SNOW for Years 1900-1940", x="Data Point", y="Amount (inches)")

```

### 1930-1980
#### Temperature and Precipitation Boxplots
```{r temperature analysis}
coldwar_era <- nyc_weather %>%
  dplyr::select(-MONTH) %>%
  filter(year(DATE) >= 1940, year(DATE) < 1980)

str(war_era)

coldwar_era %>%
  ggplot() +
  geom_histogram(aes(x=TMAX, fill="TMAX"), na.rm=TRUE, alpha=0.8, fill="steelblue", bins=100, binwidth=2) +
  labs(title="Distribution of TMAX for Years 1940-1980", x="Temperature (°F)", y="Count")

coldwar_era %>%
  dplyr::select(TMAX, TMIN, DATE) %>%
  gather(key="data_point", value="value", TMAX, TMIN) %>%
  ggplot(aes(y=value, fill=data_point)) +
  geom_boxplot(na.rm=TRUE, alpha=0.7, color="black") +
  labs(title="Distribution of TMAX and TMIN for Years 1940-1980", x="Data Point", y="Temperature (°F)")

coldwar_era %>%
  dplyr::select(PRCP, SNOW, DATE) %>%
  gather(key="data_point", value="value", PRCP, SNOW) %>%
  ggplot(aes(y=value, fill=data_point)) +
  geom_boxplot(na.rm=TRUE, alpha=0.7, color="black") +
  labs(title="Distribution of PRCP and SNOW for Years 1940-1980", x="Data Point", y="Amount (inches)")

```

### 1980 - present
#### Temperature and Precipitation Boxplots
```{r}
modern_era <- nyc_weather %>%
  dplyr::select(-MONTH) %>%
  filter(year(DATE) >= 1980) %>%
  mutate(ERA = "Modern")

str(modern_era)

modern_era %>%
  ggplot() +
  geom_histogram(aes(x=TMAX, fill="TMAX"), na.rm=TRUE, alpha=0.8, fill="steelblue", bins=100, binwidth=2) +
  labs(title="Distribution of TMAX for Years 1980-Present", x="Temperature (°F)", y="Count")

modern_era %>%
  dplyr::select(TMAX, TMIN, DATE) %>%
  gather(key="data_point", value="value", TMAX, TMIN) %>%
  ggplot(aes(y=value, fill=data_point)) +
  geom_boxplot(na.rm=TRUE, alpha=0.7, color="black") +
  labs(title="Distribution of TMAX and TMIN for Years 1980-Present", x="Data Point", y="Temperature (°F)")

modern_era %>%
  dplyr::select(PRCP, SNOW, DATE) %>%
  gather(key="data_point", value="value", PRCP, SNOW) %>%
  ggplot(aes(y=value, fill=data_point)) +
  geom_boxplot(na.rm=TRUE, alpha=0.7, color="black") +
  labs(title="Distribution of PRCP and SNOW for Years 1980-Present", x="Data Point", y="Amount (inches)")
```

### ANOVA test

#### Mean TMAX by era
```{r}
industrial_avg_tmax <- mean(industrial_era$TMAX)
coldwar_avg_tmax <- mean(coldwar_era$TMAX)
modern_avg_tmax <- mean(modern_era$TMAX)

industrial_avg_tmax
coldwar_avg_tmax
modern_avg_tmax
```

We can see above that there is an increase in average daily temperature max over the three eras.
$H_0:$ The average `TMAX` across the three eras is equal.  
$H_1:$ The average `TMAX` across the three eras is different.  
$\alpha$: `0.05`

```{r}
# combined data set

```

### Temperature vs Rain amount 2D Density plot
